# Build user-spefic kubernetes spark image from bigdl image

ARG BIGDL_NAME=intelanalytics/bigdl-ppml-trusted-big-data-ml-python-graphene
ARG BIGDL_VERSION=2.1.0-SNAPSHOT

FROM $BIGDL_NAME:$BIGDL_VERSION

ADD ./enclave-key.pem /graphene/Pal/src/host/Linux-SGX/signer/enclave-key.pem
RUN cd /ppml/trusted-big-data-ml && \
    ./init.sh && \
    rm /graphene/Pal/src/host/Linux-SGX/signer/enclave-key.pem

WORKDIR /ppml/trusted-big-data-ml

ENTRYPOINT [ "/opt/entrypoint.sh" ]

